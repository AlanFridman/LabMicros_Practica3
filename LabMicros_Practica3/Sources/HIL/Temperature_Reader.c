/*! **********************************************************************************************
* 2015  ITESM Campus Guadalajara. Laboratorio de Microcontroladores 
*  
*
* @file:      Temperature_Reader.c
* @author(s):  
*
* @brief (Theory of Operation)
*
**************************************************************************************************/


/*************************************************************************************************/
/*********************						Includes						**********************/
/*************************************************************************************************/
#include "types.h"
#include <hidef.h> /* for EnableInterrupts macro */
#include "derivative.h" /* include peripheral declarations */
#include "HAL\ADC.h"
/*************************************************************************************************/
/*********************						Defines							**********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************						Typedefs						**********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************					Function Prototypes					**********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************                  Static Variables                    **********************/
/*************************************************************************************************/
static bool Temp_overlimit;
static u8 Valor_bit;
static u8 Temperature;
static u8 V_ASCII[]={"  . ÂºC"};


/*************************************************************************************************/
/*********************					Global Variables					**********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************                  Static Constants                    **********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************                  Global Constants                    **********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************				   Exported Functions					**********************/
/*************************************************************************************************/
void Temperature_Init(void)
{
    ADC_Init;
}

char Temperature_read(void)
{
    unsigned u32 Temperature;

    Valor_bit = ADC_Read(); /*Read the convertion of the ADC*/
    Temperature=(Valor_bit*100/545);
    Temperature=((unsigned u32)(Valor_bit*3300)<<7)/255;
    Temperature=Temperature>>7;
    return Temperature;
}

void DecimaltoASCII(unsigned u8 decimal)
{
    V_ASCII[3]=decimal%10+0x30;
    decimal/=10;
    V_ASCII[1]=decimal%10+0x30;
    V_ASCII[0]=decimal/10+0x30;
}

char Temperature_overlimit(void)
{
	Temperature_BitToTemperature();
	if(Temperature > LIMIT_TEMPERATURE)
	{
	Temp_overlimit=1;
	} else Temp_overlimit=0;
    return Temp_overlimit;
}


/*************************************************************************************************/
/*********************				    Private Functions					**********************/
/*************************************************************************************************/

